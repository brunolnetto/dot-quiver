{
    "name": "requestV3",
    "description": "Fluxo para iniciar um pedido de análise de crédito.",
    "blueprint_spec": {
        "lanes": [
            {
                "id": "REQUESTBOT",
                "name": "Buyer",
                "rule": [
                    "fn",
                    [
                        "actor_data",
                        "bag"
                    ],
                    [
                        "eval",
                        [
                            "apply",
                            "or",
                            [
                                "map",
                                [
                                    "fn",
                                    [
                                        "v"
                                    ],
                                    [
                                        "=",
                                        "v",
                                        [
                                            "`",
                                            "requestBot"
                                        ]
                                    ]
                                ],
                                [
                                    "get",
                                    "actor_data",
                                    [
                                        "`",
                                        "claims"
                                    ]
                                ]
                            ]
                        ]
                    ]
                ]
            },
            {
                "id": "CONVERSION-MANAGER",
                "name": "An operator with manager rules",
                "rule": [
                    "fn",
                    [
                        "actor_data",
                        "bag"
                    ],
                    [
                        "=",
                        [
                            "get",
                            "bag",
                            [
                                "`",
                                "manager_actor_id"
                            ]
                        ],
                        [
                            "get",
                            "actor_data",
                            [
                                "`",
                                "actor_id"
                            ]
                        ]
                    ]
                ]
            }
        ],
        "nodes": [
            {
                "id": "SA",
                "name": "Start Request v3",
                "next": "PARAMETERS-BAG",
                "type": "Start",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input_schema": {
                        "type": "object",
                        "required": [
                            "party_number",
                            "chat_id",
                            "request"
                        ],
                        "properties": {
                            "chat_id": {
                                "type": "string"
                            },
                            "request": {
                                "type": "object"
                            },
                            "profiles": {
                                "type": "object"
                            },
                            "party_number": {
                                "type": "string"
                            },
                            "realtor_number": {
                                "type": "string"
                            }
                        }
                    }
                }
            },
            {
                "id": "PARAMETERS",
                "name": "Fetch parameters for the process",
                "next": "PARAMETERS-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.SERVICE_API}}}/dev_contracts?key=eq.request_PARAMETERS"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        },
                        "max_content_length": 10000
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "PARAMETERS-BAG",
                "name": "bag parameters",
                "next": "PROFILE-PROVIDED",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "buyer": {
                            "$ref": "actor_data"
                        },
                        "settings": {
                            "$ref": "result.data[0].value"
                        },
                        "author_id": {
                            "$ref": "environment.XPTO"
                        }
                    }
                }
            },
            {
                "id": "PROFILE-PROVIDED",
                "name": "Verify if the profile was provided",
                "next": {
                    "default": "PROFILE_TYPE-BAG",
                    "undefined": "PROFILE-BAG"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.profiles"
                        }
                    }
                }
            },
            {
                "id": "PROFILE-BAG",
                "name": "Set profile to bag",
                "next": "PROFILE_TYPE-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "main": {},
                            "second": {}
                        }
                    }
                }
            },
            {
                "id": "PROFILE_TYPE-BAG",
                "name": "Set profiles type to bag",
                "next": "UPDATE-REQUEST-STATUS-AWAITING_CONSENT-ON-DB",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profile_type": "main"
                    }
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-AWAITING_CONSENT-ON-DB",
                "name": "Update request status to AWAITING_CONSENT on database",
                "next": "UPDATE-REQUEST-STATUS-AWAITING_CONSENT-TO-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "AWAITING_CONSENT"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-AWAITING_CONSENT-TO-BAG",
                "name": "update request status to AWAITING_CONSENT to bag",
                "next": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-CONSENT",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$js": "({bag}) => { return { ...bag.request, status: 'AWAITING_CONSENT' }}"
                        }
                    }
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-CONSENT",
                "name": "Notify status to realtor",
                "next": "CONSENT-GETINFO",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "AGUARDANDO CONSENTIMENTO",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "CONSENT-GETINFO",
                "name": "Submit consent",
                "next": "CONSENT-RESULT",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "consent",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$js": "({bag}) => bag.profiles[bag.profile_type]"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CONSENT-RESULT",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CONSENT-RESPONSE",
                    "default": "UPDATE-REQUEST-STATUS-NO_CONSENT-ON-DB",
                    "FAIL-QUIT": "UPDATE-REQUEST-STATUS-NO_CONSENT-ON-DB",
                    "FAIL-TIMEOUT": "UPDATE-REQUEST-STATUS-NO_CONSENT-ON-DB",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CONSENT-RESPONSE",
                    "NEXT-QUESTION": "NAME-GETINFO",
                    "RETURN-CLIENT": "CONSENT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CONSENT-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "1": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-DOCS",
                    "default": "UPDATE-REQUEST-STATUS-NO_CONSENT-ON-DB"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.consent.value"
                        }
                    }
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-NO_CONSENT-ON-DB",
                "name": "Update request status to NO_CONSENT on database",
                "next": "UPDATE-REQUEST-STATUS-NO_CONSENT-TO-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "NO_CONSENT"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-NO_CONSENT-TO-BAG",
                "name": "update request status to NO_CONSENT to bag",
                "next": "NOTIFY-STATUS-HAS-CHANGED-TO-NO-CONSENT",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$js": "({bag}) => { return { ...bag.request, status: 'NO_CONSENT' }}"
                        }
                    }
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-NO-CONSENT",
                "name": "Notify status to realtor",
                "next": "CLOSE",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "SEM CONSENTIMENTO",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-DOCS",
                "name": "Notify status to realtor",
                "next": "NICKNAME-GETINFO",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "AGUARDANDO DOCUMENTOS",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "NICKNAME-GETINFO",
                "name": "Submit nickname",
                "next": "NICKNAME-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "nickname",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$js": "({bag}) => bag.profiles[bag.profile_type]"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "NICKNAME-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "NAME-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "NAME-GETINFO",
                    "NEXT-QUESTION": "NAME-GETINFO",
                    "RETURN-CLIENT": "CONSENT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "NAME-GETINFO",
                "name": "Submit name",
                "next": "NAME-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "name",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "NAME-GETINFO-SECOND_BUYER",
                "name": "Submit name",
                "next": "NAME-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "name",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$js": "({bag}) => bag.profiles[bag.profile_type]"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "NAME-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "EMAIL-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "EMAIL-GETINFO",
                    "NEXT-QUESTION": "EMAIL-GETINFO",
                    "RETURN-CLIENT": "NICKNAME-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "EMAIL-GETINFO",
                "name": "Submit email",
                "next": "EMAIL-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "email",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "EMAIL-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ID-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ID-GETINFO",
                    "NEXT-QUESTION": "ID-GETINFO",
                    "RETURN-CLIENT": "NAME-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "ID-GETINFO",
                "name": "Submit CNH or RG",
                "next": "ID-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "document_type",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "ID-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ID-DOC_TYPE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ID-DOC_TYPE",
                    "RETURN-CLIENT": "EMAIL-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "ID-DOC_TYPE",
                "name": "Flow RG or CNH",
                "next": {
                    "1": "CNH-FRONT-GETINFO",
                    "default": "RG-FRONT-GETINFO"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.document_type.value"
                        }
                    }
                }
            },
            {
                "id": "RG-FRONT-GETINFO",
                "name": "Submit RG front side",
                "next": "RG-FRONT-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "rg_front",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "RG-FRONT-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "RG-BACK-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "RG-BACK-GETINFO",
                    "NEXT-QUESTION": "RG-BACK-GETINFO",
                    "RETURN-CLIENT": "ID-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "RG-BACK-GETINFO",
                "name": "Submit RG back side",
                "next": "RG-BACK-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "rg_back",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "RG-BACK-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CPF-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CPF-GETINFO",
                    "NEXT-QUESTION": "CPF-GETINFO",
                    "RETURN-CLIENT": "RG-FRONT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CPF-GETINFO",
                "name": "Submit CPF",
                "next": "CPF-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "cpf",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CPF-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ADDRESS-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ADDRESS-GETINFO",
                    "NEXT-QUESTION": "ADDRESS-GETINFO",
                    "RETURN-CLIENT": "RG-BACK-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CNH-FRONT-GETINFO",
                "name": "Submit CNH front side",
                "next": "CNH-FRONT-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "cnh_front",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CNH-FRONT-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CNH-BACK-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CNH-BACK-GETINFO",
                    "NEXT-QUESTION": "CNH-BACK-GETINFO",
                    "RETURN-CLIENT": "ID-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CNH-BACK-GETINFO",
                "name": "Submit CNH back side",
                "next": "CNH-BACK-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "cnh_back",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CNH-BACK-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "NATURALNESS-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "NATURALNESS-GETINFO",
                    "NEXT-QUESTION": "NATURALNESS-GETINFO",
                    "RETURN-CLIENT": "CNH-FRONT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "NATURALNESS-GETINFO",
                "name": "Submit native",
                "next": "NATURALNESS-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "naturalness",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "NATURALNESS-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ADDRESS-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ADDRESS-GETINFO",
                    "NEXT-QUESTION": "ADDRESS-GETINFO",
                    "RETURN-CLIENT": "CNH-BACK-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "ADDRESS-GETINFO",
                "name": "Submit residence proof",
                "next": "ADDRESS-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "address_receipt",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "ADDRESS-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CIVIL_STATE-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CIVIL_STATE-GETINFO",
                    "NEXT-QUESTION": "CIVIL_STATE-GETINFO",
                    "RETURN-CLIENT": "ID-DOC_TYPE",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CIVIL_STATE-GETINFO",
                "name": "Submit civil status",
                "next": "CIVIL_STATE-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "civil_state",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CIVIL_STATE-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CIVIL_STATE_TYPE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CIVIL_STATE_TYPE",
                    "NEXT-QUESTION": "CIVIL_STATE_TYPE",
                    "RETURN-CLIENT": "ADDRESS-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CIVIL_STATE_TYPE",
                "name": "Flow civil status",
                "next": {
                    "1": "STABLE_UNION-GETINFO",
                    "default": "INCOME_PROOF_TYPE-GETINFO"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.civil_state.value"
                        }
                    }
                }
            },
            {
                "id": "STABLE_UNION-GETINFO",
                "name": "Submit stable union",
                "next": "STABLE_UNION-STATUS",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "stable_union",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "STABLE_UNION-STATUS",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "INCOME_PROOF_TYPE-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "INCOME_PROOF_TYPE-GETINFO",
                    "NEXT-QUESTION": "INCOME_PROOF_TYPE-GETINFO",
                    "RETURN-CLIENT": "CIVIL_STATE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "INCOME_PROOF_TYPE-GETINFO",
                "name": "Submit proof income type",
                "next": "INCOME_PROOF_TYPE-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "income_proof_type",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "INCOME_PROOF_TYPE-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "INCOME_TYPE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "INCOME_TYPE",
                    "NEXT-QUESTION": "INCOME_TYPE",
                    "RETURN-CLIENT": "STABLE_UNION-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "INCOME_TYPE",
                "name": "Flow Income Type",
                "next": {
                    "1": "PAYCHECK-GETINFO",
                    "2": "BALANCE-GETINFO",
                    "3": "PRO_LABORE-GETINFO",
                    "default": "FGTS-ELEGIBLE",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "NEXT-QUESTION": "INCOME_TYPE",
                    "RETURN-CLIENT": "STABLE_UNION-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.income_proof_type.value"
                        }
                    }
                }
            },
            {
                "id": "PAYCHECK-GETINFO",
                "name": "Submit contracheque",
                "next": "PAYCHECK-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "income_proof_paycheck",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "PAYCHECK-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ADMISSION-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ADMISSION-GETINFO",
                    "NEXT-QUESTION": "ADMISSION-GETINFO",
                    "RETURN-CLIENT": "INCOME_PROOF_TYPE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "ADMISSION-GETINFO",
                "name": "Submit admission date",
                "next": "ADMISSION-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "admission_date",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "ADMISSION-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CAREER_TIME-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CAREER_TIME-GETINFO",
                    "NEXT-QUESTION": "CAREER_TIME-GETINFO",
                    "RETURN-CLIENT": "PAYCHECK-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "BALANCE-GETINFO",
                "name": "Submit bank statement",
                "next": "BALANCE-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "income_proof_balance",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "BALANCE-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "PROFESSION-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "PROFESSION-GETINFO",
                    "NEXT-QUESTION": "PROFESSION-GETINFO",
                    "RETURN-CLIENT": "INCOME_PROOF_TYPE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "PROFESSION-GETINFO",
                "name": "Submit profession",
                "next": "PROFESSION-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "profession_title",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "PROFESSION-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "ACTIVITY_START-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "ACTIVITY_START-GETINFO",
                    "NEXT-QUESTION": "ACTIVITY_START-GETINFO",
                    "RETURN-CLIENT": "BALANCE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "ACTIVITY_START-GETINFO",
                "name": "Submit admission date",
                "next": "ACTIVITY_START-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "activity_start_date",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "ACTIVITY_START-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CAREER_TIME-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CAREER_TIME-GETINFO",
                    "NEXT-QUESTION": "CAREER_TIME-GETINFO",
                    "RETURN-CLIENT": "PROFESSION-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "PRO_LABORE-GETINFO",
                "name": "Submit pro-labore",
                "next": "PRO_LABORE-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "income_proof_prolabore",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "PRO_LABORE-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "COMPANY_FOUNDATION-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "COMPANY_FOUNDATION-GETINFO",
                    "NEXT-QUESTION": "COMPANY_FOUNDATION-GETINFO",
                    "RETURN-CLIENT": "INCOME_PROOF_TYPE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "COMPANY_FOUNDATION-GETINFO",
                "name": "Submit income proof document",
                "next": "COMPANY_FOUNDATION-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "company_foundation_date",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "COMPANY_FOUNDATION-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "SOCIAL_CONTRACT-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "SOCIAL_CONTRACT-GETINFO",
                    "NEXT-QUESTION": "SOCIAL_CONTRACT-GETINFO",
                    "RETURN-CLIENT": "PRO_LABORE-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "SOCIAL_CONTRACT-GETINFO",
                "name": "Submit admission date",
                "next": "SOCIAL_CONTRACT-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "income_proof_social_contract",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "SOCIAL_CONTRACT-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CAREER_TIME-GETINFO",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CAREER_TIME-GETINFO",
                    "NEXT-QUESTION": "CAREER_TIME-GETINFO",
                    "RETURN-CLIENT": "COMPANY_FOUNDATION-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CAREER_TIME-GETINFO",
                "name": "Submit contribution time",
                "next": "CAREER_TIME-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "career_time",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CAREER_TIME-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "FGTS-ELEGIBLE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "FGTS-ELEGIBLE",
                    "NEXT-QUESTION": "FGTS-ELEGIBLE",
                    "RETURN-CLIENT": "SOCIAL_CONTRACT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "FGTS-ELEGIBLE",
                "name": "Flow has FGTS",
                "next": {
                    "1": "FGTS_VALUE-GETINFO",
                    "default": "PROFILE_TYPE",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "NEXT-QUESTION": "FGTS-ELEGIBLE",
                    "RETURN-CLIENT": "SOCIAL_CONTRACT-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.career_time.value"
                        }
                    }
                }
            },
            {
                "id": "FGTS_VALUE-GETINFO",
                "name": "Submit FGTS value",
                "next": "FGTS_VALUE-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "fgts_value",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "FGTS_VALUE-RESPONSE",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "PROFILE_TYPE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "PROFILE_TYPE",
                    "NEXT-QUESTION": "PROFILE_TYPE",
                    "RETURN-CLIENT": "CAREER_TIME-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "PROFILE_TYPE",
                "name": "Guard for questions we ask about the main profile only",
                "next": {
                    "main": "DONT_HAVE_SECOND_YET",
                    "default": "SECOND_BUYER-PROFILE-BAG"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.profile_type"
                        }
                    }
                }
            },
            {
                "id": "DONT_HAVE_SECOND_YET",
                "name": "Check if the profile doesnt qualify for second yet",
                "next": {
                    "default": "SECOND_BUYER-KEY",
                    "divorced": "CHOOSE_SECOND-GETINFO",
                    "windower": "CHOOSE_SECOND-GETINFO",
                    "single_with_not_marriage": "CHOOSE_SECOND-GETINFO"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({result}) => result.data.profile.civil_state.value === '1' && result.data.profile.stable_union.value === '2' ? 'single_with_not_marriage' : result.data.profile.civil_state.value === '3' ? 'divorced' : result.data.profile.civil_state.value === '4' ? 'windower' : false"
                        }
                    }
                }
            },
            {
                "id": "CHOOSE_SECOND-GETINFO",
                "name": "Submit dependents",
                "next": "CHOOSE_SECOND-STATUS",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "choose_second_buyer",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "CHOOSE_SECOND-STATUS",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "CHOOSE_SECOND-RESPONSE",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "CHOOSE_SECOND-RESPONSE",
                    "NEXT-QUESTION": "CHOOSE_SECOND-RESPONSE",
                    "RETURN-CLIENT": "PROFILE_TYPE",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "CHOOSE_SECOND-RESPONSE",
                "name": "Flow civil status",
                "next": {
                    "1": "SECOND_BUYER-KEY",
                    "default": "ADD_DEPENDANTS-GETINFO",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "NEXT-QUESTION": "CHOOSE_SECOND-RESPONSE",
                    "RETURN-CLIENT": "PROFILE_TYPE",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.profile.choose_second_buyer.value"
                        }
                    }
                }
            },
            {
                "id": "ADD_DEPENDANTS-GETINFO",
                "name": "Submit dependents",
                "next": "ADD_DEPENDANTS-STATUS",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": "add_dependants",
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "profile": {
                            "$ref": "result.data.profile"
                        },
                        "request_id": {
                            "$ref": "bag.request.id"
                        },
                        "mobile_phone": {
                            "$ref": "bag.party_number"
                        },
                        "profile_type": {
                            "$ref": "bag.profile_type"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "getInfo",
                    "valid_response": "finished"
                }
            },
            {
                "id": "ADD_DEPENDANTS-STATUS",
                "name": "Verify getInfo response",
                "next": {
                    "SUCCESS": "MAIN-PROFILE-BAG",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-QUIT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "FAIL-TIMEOUT": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                    "RESET-CLIENT": "START-SUBPROCESS-TO-RESET-CLIENT",
                    "SUCCESS-NOOP": "MAIN-PROFILE-BAG",
                    "NEXT-QUESTION": "MAIN-PROFILE-BAG",
                    "RETURN-CLIENT": "CHOOSE_SECOND-GETINFO",
                    "FINISH-PROCESS": "TRIGGER-TO-FINISH"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "MAIN-PROFILE-BAG",
                "name": "Set profile to bag",
                "next": "ALL_DOCS_RECEIVED",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "$js": "({bag, result}) => ({ ...bag.profiles, [bag.profile_type]: result.data.profile })"
                        }
                    }
                }
            },
            {
                "id": "SECOND_BUYER-KEY",
                "name": "Bag profile and set key to BAG",
                "next": "NAME-GETINFO-SECOND_BUYER",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "$js": "({bag, result}) => ({ ...bag.profiles, [bag.profile_type]: result.data.profile })"
                        },
                        "profile_type": "second"
                    }
                }
            },
            {
                "id": "SECOND_BUYER-PROFILE-BAG",
                "name": "Set second buyer profiles to bag",
                "next": "ALL_DOCS_RECEIVED",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "$js": "({bag, result}) => ({ ...bag.profiles, [bag.profile_type]: result.data.profile })"
                        }
                    }
                }
            },
            {
                "id": "ALL_DOCS_RECEIVED",
                "name": "Notify that all documents were received",
                "next": "UPDATE-REQUEST-STATUS-DOCS-RECEIVED-ON-DB",
                "type": "UserTask",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "messages": [
                            {
                                "text": {
                                    "$mustache": "Bela: Muito bem!!! O Grande passo foi dado para compra da sua Casa Própria! Deixa eu te falar, agora nosso Time vai correr para analisar seus documentos e trazer uma resposta logo logo, ok? Obrigada!\nMe aguarde que eu não demoro!"
                                }
                            }
                        ],
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_MESSAGE",
                    "timeout": 1
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-DOCS-RECEIVED-ON-DB",
                "name": "Update request status to docs received on database",
                "next": "UPDATE-REQUEST-STATUS-DOCS-RECEIVED-TO-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTS_RECEIVED"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-DOCS-RECEIVED-TO-BAG",
                "name": "update request status to docs received to bag",
                "next": "NOTIFY-STATUS-HAS-CHANGED-TO-DOCS-RECEIVED",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$js": "({bag}) => { return { ...bag.request, status: 'DOCUMENTS_RECEIVED' }}"
                        }
                    }
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-DOCS-RECEIVED",
                "name": "Notify status to realtor",
                "next": "PROFILE-REVIEW",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "DOCUMENTOS RECEBIDOS",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "PROFILE-REVIEW",
                "name": "profile review subprocess",
                "next": "PROFILE-REVIEW-RESPONSE",
                "type": "SubProcess",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "request": {
                            "$ref": "bag.request"
                        },
                        "profiles": {
                            "$ref": "bag.profiles"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "observations": {
                            "$ref": "bag.observations"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        },
                        "realtor_number": {
                            "$ref": "bag.realtor_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "bag.buyer"
                    },
                    "workflow_name": "request_review",
                    "valid_response": "finished"
                }
            },
            {
                "id": "PROFILE-REVIEW-RESPONSE",
                "name": "Verify review response",
                "next": {
                    "REJECT": "REJECT-NOTIFY",
                    "REVIEW": "PROFILE-REVIEW-BAG",
                    "SUCCESS": "SUCCESS-REQUEST",
                    "default": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID"
                },
                "type": "Flow",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "result.data.status"
                        }
                    }
                }
            },
            {
                "id": "PROFILE-REVIEW-BAG",
                "name": "set profiles to bag",
                "next": "REVIEW-PROFILE_TYPE-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "$ref": "result.data.profiles"
                        },
                        "observations": {
                            "$ref": "result.data.observations"
                        }
                    }
                }
            },
            {
                "id": "REVIEW-PROFILE_TYPE-BAG",
                "name": "Set profiles type to bag",
                "next": "NICKNAME-GETINFO",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profile_type": "main"
                    }
                }
            },
            {
                "id": "REJECT-NOTIFY",
                "name": "Notify rejected request",
                "next": "CLOSE-REJECT",
                "type": "UserTask",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "messages": [
                            {
                                "text": "Bela: Que pena sua análise foi rejeitada, fale com seu corretor para mais detalhes!!!"
                            }
                        ],
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_MESSAGE",
                    "timeout": 1
                }
            },
            {
                "id": "SUCCESS-REQUEST",
                "name": "Notify success request",
                "next": "CLOSE",
                "type": "UserTask",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "messages": [
                            {
                                "text": "Bela: Parabéns!!! Sua análise foi aprovada."
                            }
                        ],
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_MESSAGE",
                    "timeout": 1
                }
            },
            {
                "id": "GET-MANAGER-ACTOR-ID-BY-REALTOR-ID",
                "name": "Get manager actor id by request realtor id",
                "next": "SET-CONVERSION-MANAGER-ACTOR-ID-TO-BAG",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "realtor_id": {
                            "$ref": "bag.request.realtor.id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.SERVICE_API}}}/rpc/profiles/get-manager-actor-id-by-realtor-id"
                        },
                        "verb": "POST",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SET-CONVERSION-MANAGER-ACTOR-ID-TO-BAG",
                "name": "set conversion manager actor id to bag",
                "next": "REALTOR-HAS-MANAGER",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "manager_actor_id": {
                            "$ref": "result.data.manager_actor_id"
                        }
                    }
                }
            },
            {
                "id": "REALTOR-HAS-MANAGER",
                "name": "Verify if realtor has manager",
                "next": {
                    "true": "UPDATE-REQUEST-STATUS-RECOVERY-ON-DB",
                    "default": "SET-DEFAULT-CONVERSION-MANAGER-ACTOR-ID-TO-BAG"
                },
                "type": "Flow",
                "lane_id": "CONVERSION-MANAGER",
                "parameters": {
                    "input": {
                        "key": {
                            "$js": "({ bag }) => !!bag.manager_actor_id"
                        }
                    }
                }
            },
            {
                "id": "SET-DEFAULT-CONVERSION-MANAGER-ACTOR-ID-TO-BAG",
                "name": "set conversion manager actor id to bag",
                "next": "UPDATE-REQUEST-STATUS-RECOVERY-ON-DB",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "manager_actor_id": {
                            "$ref": "environment.DEFAULT_MANAGER_RECOVERY_ANALYSES_ACTOR_ID"
                        }
                    }
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-RECOVERY-ON-DB",
                "name": "Update request status to docs received on database",
                "next": "NOTIFY-STATUS-HAS-CHANGED-TO-RECOVERY",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "RECOVERY"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-RECOVERY",
                "name": "Notify status to realtor",
                "next": "GET-REQUEST-DETAILS",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "RECUPERAÇÃO",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "GET-REQUEST-DETAILS",
                "name": "Get request details",
                "next": "SET-REQUEST-DETAILS-TO-BAG",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.SERVICE_API}}}/rpc/requests/{{bag.request.id}}"
                        },
                        "verb": "GET",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SET-REQUEST-DETAILS-TO-BAG",
                "name": "set request details to bag",
                "next": "REQUEST_RECOVERY-SETTINGS",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "main": {
                                "$js": "({ result }) => !!result.data.metadata?.profiles?.main ? result.data.metadata.profiles.main : {}"
                            },
                            "second": {
                                "$js": "({ result }) => !!result.data.metadata?.profiles?.second ? result.data.metadata.profiles.second : {}"
                            }
                        }
                    }
                }
            },
            {
                "id": "REQUEST_RECOVERY-SETTINGS",
                "name": "Fetch settings for request recovery.",
                "next": "REQUEST_RECOVERY-BUILD",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "HTTP",
                "parameters": {
                    "input": {},
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/dev_contracts?key=eq.request_v3_ACTION_SUBMIT_REQUEST_RECOVERY"
                        },
                        "verb": "GET",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json"
                        },
                        "max_content_length": 100000
                    },
                    "valid_response_codes": [
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "REQUEST_RECOVERY-BUILD",
                "name": "Build request recovery data",
                "next": "REQUEST_RECOVERY",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profileReview": {
                            "profiles": {
                                "main": {
                                    "$js": "({ bag }) => { const title = { name: bag.profiles?.main?.name?.value, email: bag.profiles?.main?.email?.value, phone: bag.party_number }; return { ...bag.profiles.main, title }; };"
                                },
                                "second": {
                                    "$js": "({ bag }) => { const title = { name: bag.profiles.second?.name?.value, email: bag.profiles.second?.email?.value }; return { ...bag.profiles.second, title }; };"
                                }
                            },
                            "ui_schema": {
                                "$ref": "result.data[0].value.ui_schema"
                            },
                            "activity_schema": {
                                "type": {
                                    "$ref": "result.data[0].value.activity_schema.type"
                                },
                                "properties": {
                                    "main": {
                                        "$js": "({bag, result}) => { const schema = result.data[0].value.activity_schema.properties.main.properties; const profileKeys = Object.keys(bag.profiles.main); const schemaKeys = Object.keys(result.data[0].value.activity_schema.properties.main.properties); const filteredSchema = schemaKeys.filter(key => profileKeys.includes(key)).reduce((acc, key) => { acc[key] = schema[key]; return acc; }, { title: schema['title'], additional_documents: schema['additional_documents'] }); return { type: 'object', title: '', properties: filteredSchema }; }"
                                    },
                                    "second": {
                                        "$js": "({ bag, result }) => { const profileKeys = Object.keys(bag.profiles.second); if(profileKeys.length === 0) { return undefined }; const schema = result.data[0].value.activity_schema.properties.second.properties; const schemaKeys = Object.keys(result.data[0].value.activity_schema.properties.second.properties); const filteredSchema = schemaKeys.filter((key) => profileKeys.includes(key)).reduce((acc, key) => { acc[key] = schema[key]; return acc; }, { title: schema['title'], additional_documents: schema['additional_documents'] }); return { type: 'object', title: '', properties: filteredSchema }; };"
                                    },
                                    "status": {
                                        "$ref": "result.data[0].value.activity_schema.properties.status"
                                    }
                                },
                                "definitions": {
                                    "$ref": "result.data[0].value.activity_schema.definitions"
                                }
                            }
                        }
                    }
                }
            },
            {
                "id": "REQUEST_RECOVERY",
                "name": "Desk request recovery",
                "next": "REQUEST_RECOVERY-BAG",
                "type": "UserTask",
                "lane_id": "CONVERSION-MANAGER",
                "parameters": {
                    "input": {
                        "request": {
                            "$ref": "bag.request"
                        },
                        "profiles": {
                            "$ref": "bag.profileReview.profiles"
                        },
                        "card_data": {
                            "date": {
                                "$ref": "bag.request.created_at"
                            },
                            "name": {
                                "$ref": "bag.profileReview.profiles.main.name.value"
                            },
                            "phone": {
                                "$ref": "bag.party_number"
                            }
                        },
                        "ui_schema": {
                            "$ref": "bag.profileReview.ui_schema"
                        },
                        "activity_schema": {
                            "$ref": "bag.profileReview.activity_schema"
                        }
                    },
                    "action": "SUBMIT_REQUEST_RECOVERY"
                }
            },
            {
                "id": "REQUEST_RECOVERY-BAG",
                "name": "set request recovery to bag",
                "next": "REQUEST_RECOVERY-STATUS",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "profiles": {
                            "$ref": "result.activities[0].data.profiles"
                        },
                        "profile_type": "main",
                        "request_recovery_status": {
                            "$ref": "result.activities[0].data.status"
                        }
                    }
                }
            },
            {
                "id": "REQUEST_RECOVERY-STATUS",
                "name": "Verify if the request was recovered",
                "next": {
                    "default": "CLOSE-NOTIFY",
                    "RECOVERY": "UPDATE-REQUEST-STATUS-AWAITING-DOCUMENTS-ON-DB"
                },
                "type": "Flow",
                "lane_id": "CONVERSION-MANAGER",
                "parameters": {
                    "input": {
                        "key": {
                            "$ref": "bag.request_recovery_status"
                        }
                    }
                }
            },
            {
                "id": "UPDATE-REQUEST-STATUS-AWAITING-DOCUMENTS-ON-DB",
                "name": "Update request status to AWAITING DOCUMENTS on database",
                "next": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-DOCS-AFTER-RECOVERY",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "AWAITING_DOCUMENTS"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "NOTIFY-STATUS-HAS-CHANGED-TO-AW-DOCS-AFTER-RECOVERY",
                "name": "Notify status to realtor",
                "next": "NICKNAME-GETINFO",
                "type": "SystemTask",
                "lane_id": "CONVERSION-MANAGER",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "status": "AGUARDANDO DOCUMENTOS",
                        "request": {
                            "$ref": "bag.request"
                        },
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "buyer_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "notifyMessage"
                }
            },
            {
                "id": "START-SUBPROCESS-TO-RESET-CLIENT",
                "name": "start reset client",
                "next": "NOTIFY-RESET-CLIENT",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "startProcess",
                "parameters": {
                    "input": {
                        "phone_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "actor_data": {
                        "$ref": "actor_data"
                    },
                    "workflow_name": "resetClient"
                }
            },
            {
                "id": "NOTIFY-RESET-CLIENT",
                "name": "Send message notifying reset client",
                "next": "SA",
                "type": "UserTask",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "messages": [
                            {
                                "text": "Bela: Reiniciando pedido de análise..."
                            }
                        ],
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_MESSAGE",
                    "timeout": 1
                }
            },
            {
                "id": "TRIGGER-TO-FINISH",
                "name": "Action trigger to finish process",
                "next": "SET-STATUS-CLOSED-ON-BAG",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "status": "CLOSED"
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/requests?id=eq.{{ bag.request.id }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "SET-STATUS-CLOSED-ON-BAG",
                "name": "Set status to closed on bag",
                "next": "REMOVE-CURRENT-REQUEST-ID-ON-PROFILE-BUYER",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "SetToBag",
                "parameters": {
                    "input": {
                        "request": {
                            "$js": "({bag}) => { return { ...bag.request, status: 'CLOSED' }}"
                        }
                    }
                }
            },
            {
                "id": "REMOVE-CURRENT-REQUEST-ID-ON-PROFILE-BUYER",
                "name": "Set buyer current request to null",
                "next": "INACTIVATE-CLIENT-CHAT-ID-TO-FINISH-PROCESS",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "current_request_id": null
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.POSTGREST}}}/profiles?mobile_phone=eq.{{ bag.party_number }}"
                        },
                        "verb": "PATCH",
                        "headers": {
                            "ContentType": "application/json"
                        }
                    },
                    "valid_response_codes": [
                        200,
                        201,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "INACTIVATE-CLIENT-CHAT-ID-TO-FINISH-PROCESS",
                "name": "Inactivate realtor chat id",
                "next": "CLOSE-NOTIFY",
                "type": "SystemTask",
                "lane_id": "REQUESTBOT",
                "category": "HTTP",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        }
                    },
                    "request": {
                        "url": {
                            "$mustache": "{{{environment.CHAT_API}}}/rpc/chat/inactivate-by-chat-id"
                        },
                        "verb": "POST",
                        "headers": {
                            "Prefer": "return=representation",
                            "ContentType": "application/json",
                            "Authorization": {
                                "$mustache": "Bearer {{{environment.JWT_KEY}}}"
                            }
                        }
                    },
                    "valid_response_codes": [
                        201,
                        200,
                        203,
                        204
                    ]
                }
            },
            {
                "id": "CLOSE-NOTIFY",
                "name": "Send message notifying request exit",
                "next": "CLOSE-INACTIVE",
                "type": "UserTask",
                "lane_id": "REQUESTBOT",
                "parameters": {
                    "input": {
                        "chat_id": {
                            "$ref": "bag.chat_id"
                        },
                        "messages": [
                            {
                                "text": "Bela: Que pena, infelizmente vou precisar encerrar o seu atendimento. Mas fique tranquilo(a), estarei aqui quando você estiver pronto para iniciar uma nova análise de crédito! Até mais!!!"
                            }
                        ],
                        "author_id": {
                            "$ref": "bag.author_id"
                        },
                        "party_number": {
                            "$ref": "bag.party_number"
                        }
                    },
                    "action": "NOTIFY_MESSAGE",
                    "timeout": 1
                }
            },
            {
                "id": "CLOSE-REJECT",
                "name": "Finish request status REJEITADO",
                "next": null,
                "type": "Finish",
                "lane_id": "REQUESTBOT"
            },
            {
                "id": "CLOSE",
                "name": "Finish request",
                "next": null,
                "type": "Finish",
                "lane_id": "REQUESTBOT"
            },
            {
                "id": "CLOSE-INACTIVE",
                "name": "Finish request por INATIVIDADE",
                "next": null,
                "type": "Finish",
                "lane_id": "REQUESTBOT"
            }
        ],
        "prepare": [],
        "environment": {
            "XPTO": "BOTAUTHOR",
            "CHAT_API": "CHAT_API",
            "POSTGREST": "POSTGREST",
            "SERVICE_API": "SERVICE_API",
            "DEFAULT_MANAGER_RECOVERY_ANALYSES_ACTOR_ID": "DEFAULT_MANAGER_RECOVERY_ANALYSES_ACTOR_ID"
        },
        "requirements": [
            "core"
        ]
    }
}